<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FarmLink - Farm to Business Platform</title>
    <meta name="description" content="Direct marketplace connecting farmers with businesses. Source fresh agricultural products directly from local farmers.">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: 'hsl(142 76% 36%)',
                            foreground: 'hsl(355.7 100% 97.3%)',
                            hover: 'hsl(142 76% 32%)',
                            light: 'hsl(142 76% 45%)',
                        },
                        secondary: {
                            DEFAULT: 'hsl(60 4.8% 95.9%)',
                            foreground: 'hsl(24 9.8% 10%)',
                        },
                        accent: {
                            DEFAULT: 'hsl(43 74% 66%)',
                            foreground: 'hsl(24 9.8% 10%)',
                        },
                        muted: {
                            DEFAULT: 'hsl(60 4.8% 95.9%)',
                            foreground: 'hsl(25 5.3% 44.7%)',
                        },
                        card: {
                            DEFAULT: 'hsl(0 0% 100%)',
                            foreground: 'hsl(240 10% 3.9%)',
                        },
                        border: 'hsl(20 5.9% 90%)',
                        input: 'hsl(20 5.9% 90%)',
                        ring: 'hsl(142 76% 36%)',
                    },
                    animation: {
                        'fade-up': 'fadeUp 0.5s ease-out',
                        'scale-in': 'scaleIn 0.2s ease-out',
                    },
                    keyframes: {
                        fadeUp: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        scaleIn: {
                            '0%': { opacity: '0', transform: 'scale(0.9)' },
                            '100%': { opacity: '1', transform: 'scale(1)' }
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        .gradient-primary {
            background: linear-gradient(135deg, hsl(142 76% 36%), hsl(142 76% 45%));
        }
        
        .gradient-hero {
            background: linear-gradient(135deg, hsl(142 76% 36%), hsl(120 61% 50%));
        }
        
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 25px 50px -12px hsl(142 76% 36% / 0.25);
        }
        
        .shadow-soft {
            box-shadow: 0 2px 8px -2px hsl(142 76% 36% / 0.1);
        }
        
        .shadow-medium {
            box-shadow: 0 8px 25px -5px hsl(142 76% 36% / 0.15);
        }
        
        .shadow-strong {
            box-shadow: 0 25px 50px -12px hsl(142 76% 36% / 0.25);
        }
        
        .transition-spring {
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .status-available {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .status-soldout {
            background-color: #fee2e2;
            color: #b91c1c;
        }
        
        .hero-bg {
            background-image: url('https://images.unsplash.com/photo-1574323347407-f5e1ad6d020b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2340&q=80');
            background-size: cover;
            background-position: center;
        }
        
        .animate-fade-up {
            animation: fadeUp 0.5s ease-out forwards;
        }
        
        .animate-scale-in {
            animation: scaleIn 0.2s ease-out forwards;
        }
        
        .backdrop-blur {
            backdrop-filter: blur(8px);
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans antialiased">
    <!-- Header -->
    <header class="gradient-primary text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <i data-lucide="sprout" class="w-8 h-8"></i>
                <h1 class="text-2xl font-bold">FarmLink</h1>
            </div>
            <nav id="auth-nav">
                <button id="login-btn" class="border border-white/20 text-white hover:bg-white/10 px-4 py-2 rounded-md transition-all">
                    Login
                </button>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content">
        <!-- Home Page -->
        <div id="home-page" class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
            <!-- Hero Section -->
            <div class="relative h-screen flex items-center justify-center overflow-hidden hero-bg">
                <div class="absolute inset-0 bg-black/40"></div>
                
                <div class="relative z-10 text-center text-white px-4 max-w-4xl mx-auto animate-fade-up">
                    <h1 class="text-5xl md:text-7xl font-bold mb-6 drop-shadow-lg">
                        Connecting Farmers with Businesses
                    </h1>
                    <p class="text-xl md:text-2xl mb-8 drop-shadow-md max-w-3xl mx-auto">
                        A direct marketplace for agricultural products, eliminating middlemen and ensuring fair prices for everyone
                    </p>
                    <button id="hero-login-btn" class="bg-primary-DEFAULT hover:bg-primary-hover text-white px-8 py-4 text-lg rounded-lg shadow-strong transition-spring inline-flex items-center">
                        Get Started
                        <i data-lucide="arrow-right" class="ml-2 w-5 h-5"></i>
                    </button>
                </div>
            </div>

            <!-- Features Section -->
            <div class="container mx-auto px-4 py-16 -mt-32 relative z-20">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
                    <div class="bg-white/95 backdrop-blur rounded-lg p-8 text-center card-hover shadow-soft animate-fade-up">
                        <div class="w-16 h-16 mx-auto mb-4 gradient-primary rounded-full flex items-center justify-center">
                            <i data-lucide="tractor" class="w-8 h-8 text-white"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-3">For Farmers</h3>
                        <p class="text-gray-600">
                            Sell your products directly to businesses without middlemen. Get better prices and build lasting relationships.
                        </p>
                    </div>

                    <div class="bg-white/95 backdrop-blur rounded-lg p-8 text-center card-hover shadow-soft animate-fade-up" style="animation-delay: 0.2s">
                        <div class="w-16 h-16 mx-auto mb-4 gradient-primary rounded-full flex items-center justify-center">
                            <i data-lucide="store" class="w-8 h-8 text-white"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-3">For Businesses</h3>
                        <p class="text-gray-600">
                            Source fresh, high-quality products directly from local farmers. Know your supply chain and support local agriculture.
                        </p>
                    </div>

                    <div class="bg-white/95 backdrop-blur rounded-lg p-8 text-center card-hover shadow-soft animate-fade-up" style="animation-delay: 0.4s">
                        <div class="w-16 h-16 mx-auto mb-4 gradient-primary rounded-full flex items-center justify-center">
                            <i data-lucide="trending-up" class="w-8 h-8 text-white"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-3">Better Prices</h3>
                        <p class="text-gray-600">
                            Fair pricing for both farmers and businesses. No hidden fees, no complicated commission structures.
                        </p>
                    </div>
                </div>

                <div class="text-center">
                    <div class="max-w-2xl mx-auto bg-white/95 backdrop-blur rounded-lg p-8 shadow-medium animate-fade-up" style="animation-delay: 0.6s">
                        <h2 class="text-2xl font-bold mb-4">Ready to Transform Agriculture?</h2>
                        <p class="text-gray-600 mb-6">
                            Join thousands of farmers and businesses already using FarmLink to create a more sustainable and profitable agricultural ecosystem.
                        </p>
                        <button id="cta-login-btn" class="bg-primary-DEFAULT hover:bg-primary-hover text-white px-6 py-3 rounded-lg transition-all">
                            Start Your Journey
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Menu Page -->
        <div id="menu-page" class="hidden min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
            <div class="container mx-auto px-4 py-16">
                <div class="text-center mb-12 animate-fade-up">
                    <h1 class="text-4xl font-bold mb-4">Welcome, <span id="user-name">User</span></h1>
                    <p class="text-xl text-gray-600">What would you like to do today?</p>
                </div>

                <div id="menu-items" class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl mx-auto">
                    <!-- Menu items will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Farmer Dashboard -->
        <div id="farmer-dashboard" class="hidden min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
            <div class="container mx-auto px-4 py-8">
                <button id="farmer-back-btn" class="mb-6 text-gray-600 hover:text-gray-800 flex items-center">
                    <i data-lucide="arrow-left" class="mr-2 w-4 h-4"></i>
                    Back to Menu
                </button>

                <div class="bg-white rounded-lg shadow-medium p-6 animate-fade-up">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                        <h2 class="text-3xl font-bold">Farmer Dashboard</h2>
                        <button id="add-product-btn" class="bg-primary-DEFAULT hover:bg-primary-hover text-white px-4 py-2 rounded-lg flex items-center">
                            <i data-lucide="plus" class="mr-2 w-4 h-4"></i>
                            Add Product
                        </button>
                    </div>

                    <!-- Add Product Form -->
                    <div id="product-form-container" class="hidden mb-8 bg-gray-50 rounded-lg p-6 animate-scale-in">
                        <h3 class="text-xl font-bold mb-4">Add New Product</h3>
                        <form id="product-form" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-gray-700 mb-1">Product Name</label>
                                    <input type="text" id="product-name" required class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-DEFAULT">
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-1">Quantity</label>
                                    <input type="number" id="product-quantity" required class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-DEFAULT">
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-1">Price per Unit ($)</label>
                                    <input type="number" step="0.01" id="product-price" required class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-DEFAULT">
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-1">Unit</label>
                                    <select id="product-unit" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-DEFAULT">
                                        <option value="kg">kg</option>
                                        <option value="lb">lb</option>
                                        <option value="unit">unit</option>
                                        <option value="box">box</option>
                                    </select>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button type="submit" class="bg-primary-DEFAULT hover:bg-primary-hover text-white px-4 py-2 rounded-lg">
                                    Save Product
                                </button>
                                <button type="button" id="cancel-product-btn" class="border border-gray-300 text-gray-700 hover:bg-gray-50 px-4 py-2 rounded-lg">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Products List -->
                    <div>
                        <h3 class="text-xl font-bold mb-4">Your Products</h3>
                        <div id="products-list" class="space-y-4">
                            <!-- Products will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Marketplace -->
        <div id="marketplace" class="hidden min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
            <div class="container mx-auto px-4 py-8">
                <button id="marketplace-back-btn" class="mb-6 text-gray-600 hover:text-gray-800 flex items-center">
                    <i data-lucide="arrow-left" class="mr-2 w-4 h-4"></i>
                    Back to Menu
                </button>

                <div class="bg-white rounded-lg shadow-medium p-6 animate-fade-up">
                    <h2 class="text-3xl font-bold mb-6">Marketplace</h2>
                    
                    <!-- Search -->
                    <div class="relative mb-6">
                        <i data-lucide="search" class="absolute left-3 top-3 w-4 h-4 text-gray-400"></i>
                        <input type="text" id="product-search" placeholder="Search products..." class="w-full pl-10 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-DEFAULT">
                    </div>

                    <!-- Products Grid -->
                    <div id="marketplace-products" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Products will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Login Modal -->
    <div id="login-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md m-4 animate-scale-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Login to FarmLink</h2>
                <button id="close-login" class="text-gray-500 hover:text-gray-700">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <form id="login-form" class="space-y-4">
                <div>
                    <label class="block text-gray-700 mb-1">Email</label>
                    <input type="email" id="login-email" required class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-DEFAULT">
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Password</label>
                    <input type="password" id="login-password" required class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-DEFAULT">
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Role</label>
                    <select id="login-role" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-DEFAULT">
                        <option value="farmer">Farmer</option>
                        <option value="business">Business</option>
                    </select>
                </div>
                <div id="login-error" class="hidden text-red-600 text-sm">
                    <i data-lucide="alert-circle" class="inline w-4 h-4 mr-1"></i>
                    <span>Invalid login credentials</span>
                </div>
                <button type="submit" class="w-full bg-primary-DEFAULT hover:bg-primary-hover text-white p-3 rounded-lg">
                    Login
                </button>
            </form>
            
            <div class="mt-6 text-sm text-gray-600 space-y-1">
                <p><strong>Demo Accounts:</strong></p>
                <p>Farmer: farmer@example.com / farmer123</p>
                <p>Business: business@example.com / business123</p>
            </div>
        </div>
    </div>

    <!-- Order Modal -->
    <div id="order-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md m-4 animate-scale-in">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">Order Product</h3>
                <button id="close-order" class="text-gray-500 hover:text-gray-700">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <form id="order-form" class="space-y-4">
                <div>
                    <label class="block text-gray-700 mb-1">Quantity</label>
                    <input type="number" id="order-quantity" min="1" required class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-DEFAULT">
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Delivery Date</label>
                    <input type="date" id="order-date" required class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-DEFAULT">
                </div>
                <div>
                    <label class="block text-gray-700 mb-1">Special Instructions</label>
                    <textarea id="order-notes" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-DEFAULT" rows="3"></textarea>
                </div>
                <div id="order-total" class="hidden p-3 bg-gray-50 rounded-lg">
                    <p class="font-semibold">Order Total: $<span id="total-amount">0</span></p>
                </div>
                <div class="flex space-x-2">
                    <button type="submit" class="flex-1 bg-primary-DEFAULT hover:bg-primary-hover text-white p-3 rounded-lg">
                        Place Order
                    </button>
                    <button type="button" id="cancel-order-btn" class="flex-1 border border-gray-300 text-gray-700 hover:bg-gray-50 p-3 rounded-lg">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed top-4 right-4 bg-white border border-green-200 text-green-800 px-6 py-4 rounded-lg shadow-lg hidden z-50">
        <div class="flex items-center">
            <i data-lucide="check-circle" class="w-5 h-5 mr-2 text-green-600"></i>
            <span id="toast-message">Action completed successfully!</span>
        </div>
    </div>

    <!-- Footer -->
    <footer class="gradient-primary text-white p-4 text-center">
        <p>&copy; 2025 FarmLink. All rights reserved.</p>
    </footer>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Application State
        const state = {
            users: [
                { id: 1, email: 'farmer@example.com', password: 'farmer123', name: 'John Farmer', role: 'farmer' },
                { id: 2, email: 'business@example.com', password: 'business123', name: 'Fresh Market', role: 'business' }
            ],
            products: [
                { id: 1, name: 'Organic Apples', quantity: 500, price: 2.5, unit: 'kg', farmerId: 1, status: 'Available' },
                { id: 2, name: 'Fresh Tomatoes', quantity: 300, price: 1.8, unit: 'kg', farmerId: 1, status: 'Available' },
                { id: 3, name: 'Whole Wheat', quantity: 1000, price: 0.8, unit: 'kg', farmerId: 1, status: 'Available' }
            ],
            orders: [],
            currentUser: null,
            lastProductId: 3,
            lastOrderId: 0,
            currentView: 'home',
            currentOrderProduct: null
        };

        // DOM Elements
        const elements = {
            homePage: document.getElementById('home-page'),
            menuPage: document.getElementById('menu-page'),
            farmerDashboard: document.getElementById('farmer-dashboard'),
            marketplace: document.getElementById('marketplace'),
            loginModal: document.getElementById('login-modal'),
            orderModal: document.getElementById('order-modal'),
            toast: document.getElementById('toast')
        };

        // Utility Functions
        function showToast(message) {
            document.getElementById('toast-message').textContent = message;
            elements.toast.classList.remove('hidden');
            setTimeout(() => {
                elements.toast.classList.add('hidden');
            }, 3000);
        }

        function showModal(modal) {
            modal.classList.remove('hidden');
        }

        function hideModal(modal) {
            modal.classList.add('hidden');
        }

        function showView(viewName) {
            // Hide all views
            Object.values(elements).forEach(el => {
                if (el && el.classList) {
                    el.classList.add('hidden');
                }
            });
            
            // Show selected view
            if (elements[viewName]) {
                elements[viewName].classList.remove('hidden');
            }
            
            state.currentView = viewName;
            updateAuthNav();
        }

        // Authentication Functions
        function updateAuthNav() {
            const authNav = document.getElementById('auth-nav');
            if (state.currentUser) {
                authNav.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <span class="hidden sm:inline text-white/90">Welcome, ${state.currentUser.name}</span>
                        <button id="logout-btn" class="border border-white/20 text-white hover:bg-white/10 px-4 py-2 rounded-md transition-all">
                            Logout
                        </button>
                    </div>
                `;
                document.getElementById('logout-btn').addEventListener('click', logout);
            } else {
                authNav.innerHTML = `
                    <button id="login-btn" class="border border-white/20 text-white hover:bg-white/10 px-4 py-2 rounded-md transition-all">
                        Login
                    </button>
                `;
                document.getElementById('login-btn').addEventListener('click', () => showModal(elements.loginModal));
            }
        }

        function login(email, password, role) {
            const user = state.users.find(u => 
                u.email === email && u.password === password && u.role === role
            );
            
            if (user) {
                state.currentUser = user;
                showView('menuPage');
                hideModal(elements.loginModal);
                showToast(`Welcome back, ${user.name}!`);
                renderMenu();
                return true;
            }
            return false;
        }

        function logout() {
            state.currentUser = null;
            showView('homePage');
            showToast('You have been logged out.');
        }

        // Render Functions
        function renderMenu() {
            const userName = document.getElementById('user-name');
            const menuItems = document.getElementById('menu-items');
            
            userName.textContent = state.currentUser.name;
            
            const farmerItems = [
                { icon: 'tractor', title: 'Manage Products', desc: 'View, add, edit or delete your products', action: () => showFarmerDashboard() },
                { icon: 'clipboard-list', title: 'View Orders', desc: 'See orders for your products', action: () => showToast('Orders feature coming soon!') }
            ];
            
            const businessItems = [
                { icon: 'store', title: 'Browse Marketplace', desc: 'Find products from local farmers', action: () => showMarketplace() },
                { icon: 'history', title: 'Order History', desc: 'View your past orders', action: () => showToast('Order history coming soon!') }
            ];
            
            const commonItems = [
                { icon: 'user', title: 'Profile Settings', desc: 'Update your account information', action: () => showToast('Profile settings coming soon!') },
                { icon: 'help-circle', title: 'Help & Support', desc: 'Get assistance with the platform', action: () => showToast('Help section coming soon!') }
            ];
            
            const items = state.currentUser.role === 'farmer' ? [...farmerItems, ...commonItems] : [...businessItems, ...commonItems];
            
            menuItems.innerHTML = items.map((item, index) => `
                <div class="bg-white rounded-lg p-8 text-center card-hover shadow-soft cursor-pointer animate-fade-up" 
                     style="animation-delay: ${index * 0.1}s" onclick="menuItemClick(${index})">
                    <div class="w-16 h-16 mx-auto mb-4 gradient-primary rounded-full flex items-center justify-center">
                        <i data-lucide="${item.icon}" class="w-8 h-8 text-white"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2">${item.title}</h3>
                    <p class="text-gray-600">${item.desc}</p>
                </div>
            `).join('');
            
            // Store actions for menu items
            window.menuActions = items.map(item => item.action);
            
            lucide.createIcons();
        }

        function showFarmerDashboard() {
            showView('farmerDashboard');
            renderFarmerProducts();
        }

        function showMarketplace() {
            showView('marketplace');
            renderMarketplace();
        }

        function renderFarmerProducts() {
            const productsList = document.getElementById('products-list');
            const farmerProducts = state.products.filter(p => p.farmerId === state.currentUser.id);
            
            if (farmerProducts.length === 0) {
                productsList.innerHTML = `
                    <div class="bg-white border rounded-lg p-8 text-center text-gray-600">
                        <p>No products added yet. Click "Add Product" to get started!</p>
                    </div>
                `;
            } else {
                productsList.innerHTML = farmerProducts.map(product => `
                    <div class="bg-white border rounded-lg p-4 card-hover">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <h4 class="font-semibold text-lg">${product.name}</h4>
                                <p class="text-gray-600">
                                    ${product.quantity} ${product.unit} available at $${product.price}/${product.unit}
                                </p>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="px-2 py-1 rounded-full text-xs ${product.status === 'Available' ? 'status-available' : 'status-soldout'}">
                                    ${product.status}
                                </span>
                                <button onclick="deleteProduct(${product.id})" class="text-red-600 hover:text-red-800 p-1">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            lucide.createIcons();
        }

        function renderMarketplace() {
            const marketplaceProducts = document.getElementById('marketplace-products');
            const availableProducts = state.products.filter(p => p.status === 'Available');
            
            if (availableProducts.length === 0) {
                marketplaceProducts.innerHTML = `
                    <div class="col-span-full bg-white border rounded-lg p-8 text-center text-gray-600">
                        <p>No products available right now. Check back later!</p>
                    </div>
                `;
            } else {
                marketplaceProducts.innerHTML = availableProducts.map((product, index) => `
                    <div class="bg-white rounded-lg p-6 card-hover shadow-soft animate-fade-up" 
                         style="animation-delay: ${index * 0.1}s">
                        <h4 class="text-lg font-semibold mb-2">${product.name}</h4>
                        <div class="space-y-2 text-sm text-gray-600 mb-4">
                            <p>📦 ${product.quantity} ${product.unit} available</p>
                            <p>💰 $${product.price}/${product.unit}</p>
                            <p>👨‍🌾 John Farmer</p>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="px-2 py-1 rounded-full text-xs status-available">
                                ${product.status}
                            </span>
                            <button onclick="openOrderModal(${product.id})" class="bg-primary-DEFAULT hover:bg-primary-hover text-white px-3 py-1 rounded text-sm flex items-center">
                                <i data-lucide="shopping-cart" class="mr-1 w-4 h-4"></i>
                                Order
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            lucide.createIcons();
        }

        // Product Management
        function addProduct(productData) {
            const newProduct = {
                ...productData,
                id: ++state.lastProductId,
                farmerId: state.currentUser.id,
                status: 'Available'
            };
            
            state.products.push(newProduct);
            renderFarmerProducts();
            showToast(`${newProduct.name} has been added to your inventory.`);
        }

        function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                const product = state.products.find(p => p.id === productId);
                state.products = state.products.filter(p => p.id !== productId);
                renderFarmerProducts();
                if (product) {
                    showToast(`${product.name} has been removed from your inventory.`);
                }
            }
        }

        // Order Management
        function openOrderModal(productId) {
            const product = state.products.find(p => p.id === productId);
            if (!product) return;
            
            state.currentOrderProduct = product;
            document.getElementById('order-quantity').max = product.quantity;
            showModal(elements.orderModal);
        }

        function placeOrder(orderData) {
            const product = state.currentOrderProduct;
            if (!product || !state.currentUser) return;

            const newOrder = {
                id: ++state.lastOrderId,
                ...orderData,
                productId: product.id,
                businessId: state.currentUser.id,
                totalPrice: orderData.quantity * product.price,
                orderDate: new Date().toISOString(),
                status: 'Pending'
            };

            // Update product quantity
            product.quantity -= orderData.quantity;
            if (product.quantity <= 0) {
                product.status = 'Sold Out';
            }

            state.orders.push(newOrder);
            hideModal(elements.orderModal);
            renderMarketplace();
            showToast(`Your order for ${orderData.quantity} ${product.unit} of ${product.name} has been placed.`);
        }

        // Global functions for onclick handlers
        window.menuItemClick = function(index) {
            window.menuActions[index]();
        };

        window.deleteProduct = deleteProduct;
        window.openOrderModal = openOrderModal;

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Login buttons
            document.getElementById('hero-login-btn').addEventListener('click', () => showModal(elements.loginModal));
            document.getElementById('cta-login-btn').addEventListener('click', () => showModal(elements.loginModal));
            
            // Modal close buttons
            document.getElementById('close-login').addEventListener('click', () => hideModal(elements.loginModal));
            document.getElementById('close-order').addEventListener('click', () => hideModal(elements.orderModal));
            
            // Back buttons
            document.getElementById('farmer-back-btn').addEventListener('click', () => showView('menuPage'));
            document.getElementById('marketplace-back-btn').addEventListener('click', () => showView('menuPage'));
            
            // Product form
            document.getElementById('add-product-btn').addEventListener('click', () => {
                document.getElementById('product-form-container').classList.remove('hidden');
            });
            
            document.getElementById('cancel-product-btn').addEventListener('click', () => {
                document.getElementById('product-form-container').classList.add('hidden');
                document.getElementById('product-form').reset();
            });
            
            document.getElementById('product-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                const productData = {
                    name: formData.get('name') || document.getElementById('product-name').value,
                    quantity: parseFloat(document.getElementById('product-quantity').value),
                    price: parseFloat(document.getElementById('product-price').value),
                    unit: document.getElementById('product-unit').value
                };
                
                addProduct(productData);
                document.getElementById('product-form-container').classList.add('hidden');
                this.reset();
            });
            
            // Login form
            document.getElementById('login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                const role = document.getElementById('login-role').value;
                
                if (!login(email, password, role)) {
                    document.getElementById('login-error').classList.remove('hidden');
                } else {
                    document.getElementById('login-error').classList.add('hidden');
                }
            });
            
            // Order form
            document.getElementById('cancel-order-btn').addEventListener('click', () => hideModal(elements.orderModal));
            
            document.getElementById('order-quantity').addEventListener('input', function() {
                const quantity = parseFloat(this.value);
                const product = state.currentOrderProduct;
                if (quantity && product) {
                    const total = quantity * product.price;
                    document.getElementById('total-amount').textContent = total.toFixed(2);
                    document.getElementById('order-total').classList.remove('hidden');
                } else {
                    document.getElementById('order-total').classList.add('hidden');
                }
            });
            
            document.getElementById('order-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const orderData = {
                    quantity: parseFloat(document.getElementById('order-quantity').value),
                    deliveryDate: document.getElementById('order-date').value,
                    notes: document.getElementById('order-notes').value
                };
                
                placeOrder(orderData);
                this.reset();
                document.getElementById('order-total').classList.add('hidden');
            });
            
            // Search functionality
            document.getElementById('product-search').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const products = document.querySelectorAll('#marketplace-products > div');
                
                products.forEach(product => {
                    const productName = product.querySelector('h4').textContent.toLowerCase();
                    if (productName.includes(searchTerm)) {
                        product.style.display = 'block';
                    } else {
                        product.style.display = 'none';
                    }
                });
            });
            
            // Initialize icons and view
            lucide.createIcons();
            updateAuthNav();
        });
    </script>
</body>
</html>
